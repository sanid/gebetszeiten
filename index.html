<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gebetszeiten Deutschland & Weltweit</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .prayer-active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transform: scale(1.02);
            box-shadow: 0 10px 15px -3px rgba(16, 185, 129, 0.3);
        }
        .loader {
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #10b981;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800 antialiased min-h-screen flex flex-col">

    <!-- Header / Hero Section -->
    <header class="bg-slate-900 text-white pb-24 pt-8 px-4 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full opacity-10">
            <i class="fas fa-mosque absolute -bottom-10 -right-10 text-9xl"></i>
            <i class="far fa-star absolute top-10 left-10 text-4xl animate-pulse"></i>
        </div>

        <div class="max-w-2xl mx-auto relative z-10">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">Gebetszeiten</h1>
                    <p class="text-slate-400 text-sm" id="current-date-display">Lädt...</p>
                </div>
                
                <div class="flex items-center gap-2">
                    <button onclick="toggleSettings()" class="bg-slate-800 hover:bg-slate-700 py-2 px-3 rounded-full transition flex items-center shadow-lg border border-slate-700">
                        <i class="fas fa-map-marker-alt text-emerald-400"></i> 
                        <span id="location-name" class="ml-2 text-sm font-medium hidden sm:inline">Berlin</span>
                    </button>
                    <button onclick="toggleSettings()" class="bg-slate-800 hover:bg-slate-700 p-2 rounded-full transition w-10 h-10 flex items-center justify-center shadow-lg border border-slate-700" title="Einstellungen">
                        <i class="fas fa-cog text-slate-300 hover:text-white transition-colors"></i>
                    </button>
                </div>
            </div>

            <!-- Next Prayer Highlight -->
            <div class="text-center mt-6">
                <p class="text-slate-400 text-sm uppercase tracking-wider mb-1">Nächstes Gebet in</p>
                <div id="countdown" class="text-4xl md:text-5xl font-bold font-mono text-emerald-400 mb-2">--:--:--</div>
                <p id="next-prayer-name" class="text-xl font-medium text-white">Lädt...</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow px-4 -mt-16 relative z-20 pb-10">
        <div class="max-w-2xl mx-auto space-y-6">

            <!-- Settings Panel (Hidden by default) -->
            <div id="settings-panel" class="hidden glass-card rounded-2xl shadow-xl p-6 mb-6 animate-fade-in ring-1 ring-black/5">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg text-gray-800">Einstellungen</h3>
                    <button onclick="toggleSettings()" class="text-gray-400 hover:text-gray-600"><i class="fas fa-times"></i></button>
                </div>
                
                <!-- Location Section -->
                <div class="mb-6">
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Standort</label>
                    <div class="flex gap-2 mb-3">
                        <input type="text" id="city-search" placeholder="Stadt eingeben (z.B. Köln)..." 
                               class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none">
                        <button onclick="searchCity()" class="bg-slate-800 text-white px-4 py-2 rounded-lg hover:bg-slate-700">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <button onclick="detectLocation()" class="w-full py-2 border border-emerald-500 text-emerald-600 rounded-lg hover:bg-emerald-50 transition flex justify-center items-center gap-2 text-sm font-medium">
                        <i class="fas fa-location-arrow"></i> Meinen Standort verwenden
                    </button>
                    <div id="location-loading" class="hidden justify-center mt-2"><div class="loader"></div></div>
                </div>

                <div class="h-px bg-gray-200 w-full mb-6"></div>

                <!-- Method Section -->
                <div>
                    <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Berechnungsmethode</label>
                    <select id="method-select" onchange="changeMethod()" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:outline-none bg-white text-gray-700">
                        <option value="3">Muslim World League (Standard für Europa)</option>
                        <option value="2">Islamic Society of North America (ISNA)</option>
                        <option value="4">Umm Al-Qura University, Makkah</option>
                        <option value="5">Egyptian General Authority of Survey</option>
                        <option value="13">Diyanet İşleri Başkanlığı, Türkei</option>
                        <option value="12">Union Organization islamic de France</option>
                        <option value="1">University of Islamic Sciences, Karachi</option>
                        <option value="0">Shia Ithna-Ashari, Leva Institute, Qum</option>
                        <option value="7">Institute of Geophysics, University of Tehran</option>
                        <option value="8">Gulf Region</option>
                        <option value="9">Kuwait</option>
                        <option value="10">Qatar</option>
                        <option value="11">Majlis Ugama Islam Singapura</option>
                        <option value="14">Spiritual Administration of Muslims of Russia</option>
                    </select>
                    <p class="text-xs text-gray-400 mt-2">Diese Einstellung beeinflusst hauptsächlich Fajr- und Isha-Zeiten.</p>
                </div>
            </div>

            <!-- Today's Times Cards -->
            <div class="glass-card rounded-2xl shadow-lg overflow-hidden">
                <div class="bg-gray-50 border-b border-gray-100 p-4 flex justify-between items-center">
                    <h2 class="font-bold text-gray-700">
                        <i class="far fa-calendar-alt mr-2 text-emerald-500"></i>Heute 
                        <span id="today-gregorian" class="text-sm font-normal text-gray-500 ml-1"></span>
                    </h2>
                    <span class="text-xs bg-emerald-100 text-emerald-700 px-2 py-1 rounded-full" id="hijri-date">Hijri Datum</span>
                </div>
                
                <div class="divide-y divide-gray-100" id="prayer-list">
                    <!-- Prayer Items will be injected here -->
                    <div class="p-4 text-center text-gray-500">Daten werden geladen...</div>
                </div>
            </div>

            <!-- Monthly Calendar View -->
            <div class="glass-card rounded-2xl shadow-lg overflow-hidden mt-6">
                 <div class="bg-gray-50 border-b border-gray-100 p-4 flex justify-between items-center flex-wrap gap-2">
                    <h2 class="font-bold text-gray-700"><i class="fas fa-table mr-2 text-emerald-500"></i>Monatsübersicht</h2>
                    
                    <!-- Month Navigation -->
                    <div class="flex items-center gap-2 bg-white rounded-lg border border-gray-200 p-1">
                        <button onclick="changeMonth(-1)" class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-gray-600 transition">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span id="month-display" class="text-sm font-semibold w-32 text-center text-gray-700 select-none">Lade...</span>
                        <button onclick="changeMonth(1)" class="w-8 h-8 flex items-center justify-center hover:bg-gray-100 rounded text-gray-600 transition">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <!-- Adjusted table for mobile responsiveness -->
                    <table class="w-full text-xs md:text-sm text-left text-gray-500">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" class="px-2 py-3 md:px-4">Tag</th>
                                <th scope="col" class="px-1 py-3 md:px-4 text-center">Fajr</th>
                                <th scope="col" class="px-1 py-3 md:px-4 text-center">Dhuhr</th>
                                <th scope="col" class="px-1 py-3 md:px-4 text-center">Asr</th>
                                <th scope="col" class="px-1 py-3 md:px-4 text-center">Maghrib</th>
                                <th scope="col" class="px-1 py-3 md:px-4 text-center">Isha</th>
                            </tr>
                        </thead>
                        <tbody id="month-table-body">
                            <!-- Rows injected via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-auto py-6">
        <div class="max-w-2xl mx-auto text-center px-4">
            <p class="text-xs text-gray-400">Datenquelle: Aladhan API.</p>
            <p class="text-xs text-gray-400 mt-2">&copy; 2026 Gebetszeiten App - s4nid</p>
        </div>
    </footer>

    <script>
        // --- Configuration & State ---
        // Fallback, falls Erkennung fehlschlägt
        const DEFAULT_LOCATION = {
            name: "Berlin",
            lat: 52.5200,
            lng: 13.4050
        };

        const DEFAULT_METHOD = 3; // Muslim World League

        // Standard Prayer names mapping for German UI
        const PRAYER_NAMES = {
            Fajr: "Fajr (Morgendämmerung)",
            Sunrise: "Sonnenaufgang",
            Dhuhr: "Dhuhr (Mittag)",
            Asr: "Asr (Nachmittag)",
            Maghrib: "Maghrib (Abend)",
            Isha: "Isha (Nacht)"
        };

        const TRACKED_PRAYERS = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

        let appState = {
            location: null,
            method: DEFAULT_METHOD,
            timings: null,
            nextPrayer: null,
            currentPrayer: null, // Neu: Für die Hervorhebung
            viewDate: new Date() // Neu: Für die Kalender-Navigation
        };

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            updateDateDisplay();
            updateMonthDisplay(); // Initiale Anzeige für Monatsnav
            loadSettings();
            
            // Set up search enter key
            document.getElementById('city-search').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') searchCity();
            });

            // Update countdown every second
            setInterval(updateCountdown, 1000);
        });

        function loadSettings() {
            // 1. Load Method
            const savedMethod = localStorage.getItem('prayerAppMethod');
            if (savedMethod) {
                appState.method = parseInt(savedMethod);
            }
            // Set dropdown value
            document.getElementById('method-select').value = appState.method;

            // 2. Load Location
            const savedLocation = localStorage.getItem('prayerAppLocation');
            if (savedLocation) {
                appState.location = JSON.parse(savedLocation);
                document.getElementById('location-name').innerText = appState.location.name;
                // Location exists, fetch data
                fetchPrayerData();
            } else {
                // No location -> Auto Detect
                document.getElementById('location-name').innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                detectLocation();
            }
        }

        function toggleSettings() {
            const el = document.getElementById('settings-panel');
            el.classList.toggle('hidden');
        }

        // --- Settings Logic ---

        function changeMethod() {
            const select = document.getElementById('method-select');
            const newMethod = select.value;
            appState.method = newMethod;
            localStorage.setItem('prayerAppMethod', newMethod);
            
            // Refetch data with new method if we have a location
            if (appState.location) {
                // Visual feedback
                document.getElementById('prayer-list').innerHTML = '<div class="p-4 text-center text-emerald-600"><i class="fas fa-sync fa-spin mr-2"></i>Aktualisiere Zeiten...</div>';
                fetchPrayerData();
            }
        }

        function updateDateDisplay() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date-display').innerText = now.toLocaleDateString('de-DE', options);
            
            // Update Gregorian date next to "Heute"
            const shortOptions = { day: '2-digit', month: '2-digit', year: 'numeric' };
            const shortDate = now.toLocaleDateString('de-DE', shortOptions);
            const todayEl = document.getElementById('today-gregorian');
            if (todayEl) {
                todayEl.innerText = `(${shortDate})`;
            }
        }

        // --- Month Navigation Logic ---

        function changeMonth(offset) {
            // Ändere das Datum im State
            const currentView = appState.viewDate;
            currentView.setMonth(currentView.getMonth() + offset);
            appState.viewDate = new Date(currentView); // Trigger update mit neuem Objekt

            updateMonthDisplay();
            
            // Lade Daten für den neuen Monat
            if (appState.location) {
                document.getElementById('month-table-body').innerHTML = '<tr><td colspan="6" class="text-center py-4"><div class="loader mx-auto"></div></td></tr>';
                fetchPrayerData();
            }
        }

        function updateMonthDisplay() {
            const options = { month: 'long', year: 'numeric' };
            document.getElementById('month-display').innerText = appState.viewDate.toLocaleDateString('de-DE', options);
        }

        // --- Location Logic ---

        function saveLocation(name, lat, lng) {
            appState.location = { name, lat, lng };
            localStorage.setItem('prayerAppLocation', JSON.stringify(appState.location));
            
            document.getElementById('location-name').innerText = name;
            
            // Close settings only if opened (simple toggle logic might need care, but fine here)
            // Ideally we check if it's visible. 
            const settingsPanel = document.getElementById('settings-panel');
            if(!settingsPanel.classList.contains('hidden')) {
                settingsPanel.classList.add('hidden');
            }

            fetchPrayerData(); 
        }

        // 1. Browser Geolocation
        function detectLocation() {
            const loader = document.getElementById('location-loading');
            loader.classList.remove('hidden');
            loader.classList.add('flex');

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        reverseGeocode(lat, lng);
                    },
                    (error) => {
                        console.warn("Browser geo failed", error);
                        detectLocationViaIP(); 
                    }
                );
            } else {
                detectLocationViaIP();
            }
        }

        // 2. IP Geolocation Fallback
        async function detectLocationViaIP() {
            try {
                const response = await fetch('https://ipwho.is/'); 
                const data = await response.json();
                
                if (data.success) {
                    saveLocation(data.city, data.latitude, data.longitude);
                } else {
                    throw new Error("IP Location failed");
                }
            } catch (e) {
                console.error("Standort fehlgeschlagen", e);
                if (!appState.location) {
                    saveLocation(DEFAULT_LOCATION.name, DEFAULT_LOCATION.lat, DEFAULT_LOCATION.lng);
                    alert("Standort nicht ermittelbar. Berlin geladen.");
                }
            } finally {
                const loader = document.getElementById('location-loading');
                loader.classList.remove('flex');
                loader.classList.add('hidden');
            }
        }

        // Reverse Geocode
        async function reverseGeocode(lat, lng) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                const data = await response.json();
                const city = data.address.city || data.address.town || data.address.village || "Mein Standort";
                saveLocation(city, lat, lng);
            } catch (e) {
                saveLocation("Mein Standort", lat, lng);
            } finally {
                const loader = document.getElementById('location-loading');
                loader.classList.remove('flex');
                loader.classList.add('hidden');
            }
        }

        // Manual Search
        async function searchCity() {
            const query = document.getElementById('city-search').value;
            if (!query) return;

            const btn = document.querySelector('#settings-panel button'); // Gets the first button in panel (search)
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<div class="loader"></div>';

            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data && data.length > 0) {
                    saveLocation(data[0].name, parseFloat(data[0].lat), parseFloat(data[0].lon));
                    document.getElementById('city-search').value = '';
                } else {
                    alert('Stadt nicht gefunden.');
                }
            } catch (e) {
                console.error(e);
                alert('Fehler bei der Suche.');
            } finally {
                btn.innerHTML = originalHTML;
            }
        }

        // --- Aladhan API Integration ---

        async function fetchPrayerData() {
            if (!appState.location) return;

            // Nutze appState.viewDate statt new Date() für die Abfrage
            const viewDate = appState.viewDate;
            const year = viewDate.getFullYear();
            const month = viewDate.getMonth() + 1;
            
            // Use the selected method
            const method = appState.method || DEFAULT_METHOD;
            
            const url = `https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=${appState.location.lat}&longitude=${appState.location.lng}&method=${method}&school=1`;

            try {
                const response = await fetch(url);
                const json = await response.json();
                
                if (json.code === 200) {
                    processAPIData(json.data);
                }
            } catch (e) {
                console.error("API Error", e);
                document.getElementById('prayer-list').innerHTML = '<div class="p-4 text-red-500 text-center">Fehler beim Laden der Daten.</div>';
            }
        }

        function processAPIData(data) {
            const now = new Date();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();

            // Check ob die geladenen Daten dem aktuellen realen Monat entsprechen
            // API gibt Datum im gregorian object zurück
            if (data.length > 0) {
                const dataMonth = parseInt(data[0].date.gregorian.month.number);
                const dataYear = parseInt(data[0].date.gregorian.year);
                
                const isCurrentMonth = (dataMonth === currentMonth && dataYear === currentYear);

                // NUR wenn wir im aktuellen Monat sind, aktualisieren wir die "Heute" Ansicht
                if (isCurrentMonth) {
                    const todayDate = now.getDate();
                    const todayData = data.find(d => parseInt(d.date.gregorian.day) === todayDate);

                    if (todayData) {
                        appState.timings = todayData.timings;
                        
                        const hijri = todayData.date.hijri;
                        document.getElementById('hijri-date').innerText = `${hijri.day} ${hijri.month.en} ${hijri.year}`;

                        updatePrayerStates(appState.timings); 
                        renderTodayList(appState.timings);
                    }
                }
            }
            
            // Die Kalendertabelle wird IMMER aktualisiert mit den geladenen Daten
            renderMonthTable(data);
        }

        function parseTime(timeStr) {
            return timeStr.split(' ')[0];
        }

        // Neue Logik für Status & Countdown
        function updatePrayerStates(timings) {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            // 1. Nächstes Gebet finden (für Countdown)
            // Wir schauen nur nach den Gebeten für den Countdown (TRACKED_PRAYERS)
            let foundNext = false;
            for (let prayer of TRACKED_PRAYERS) {
                const timeRaw = parseTime(timings[prayer]);
                const [h, m] = timeRaw.split(':').map(Number);
                const prayerMinutes = h * 60 + m;

                if (prayerMinutes > currentTime) {
                    appState.nextPrayer = {
                        name: prayer,
                        time: timeRaw,
                        obj: new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m)
                    };
                    foundNext = true;
                    break;
                }
            }

            if (!foundNext) {
                const fajrRaw = parseTime(timings['Fajr']);
                const [h, m] = fajrRaw.split(':').map(Number);
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(h, m, 0, 0);

                appState.nextPrayer = {
                    name: 'Fajr',
                    time: fajrRaw,
                    obj: tomorrow
                };
            }

            document.getElementById('next-prayer-name').innerText = PRAYER_NAMES[appState.nextPrayer.name];

            // 2. Aktuelles Gebet finden (für Hervorhebung in der Liste)
            // Hier nutzen wir alle Events inkl. Sunrise, damit die Markierung korrekt weiterspringt
            const allEvents = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
            let current = null;

            for (let event of allEvents) {
                const timeRaw = parseTime(timings[event]);
                const [h, m] = timeRaw.split(':').map(Number);
                const eventMinutes = h * 60 + m;

                if (eventMinutes <= currentTime) {
                    current = event; // Merke das letzte Event, das <= jetzt ist
                }
            }
            appState.currentPrayer = current;
        }

        function updateCountdown() {
            if (!appState.nextPrayer) return;

            const now = new Date();
            const diff = appState.nextPrayer.obj - now;

            if (diff <= 0) {
                // Wenn wir den Monat gewechselt haben und der Countdown abläuft,
                // wollen wir eigentlich die "echten" Daten neu laden.
                // Da fetchPrayerData nun viewDate nutzt, setzen wir viewDate kurz zurück oder laden separat.
                // Einfacher Hack: Wir setzen viewDate auf Heute zurück, damit der User sieht dass ein neuer Tag ist.
                // Oder wir lassen es so, dann aktualisiert sich nur der Countdown falls möglich.
                // Beste UX: Seite neu laden oder current data neu fetchen.
                
                // Wir resetten hier viewDate auf current date um sicherzugehen dass "Heute" aktualisiert wird
                appState.viewDate = new Date();
                updateMonthDisplay();
                fetchPrayerData(); 
                return;
            }

            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('countdown').innerText = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function renderTodayList(timings) {
            const container = document.getElementById('prayer-list');
            container.innerHTML = '';

            const order = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

            order.forEach(key => {
                const time = parseTime(timings[key]);
                // ÄNDERUNG: Prüfe auf currentPrayer statt nextPrayer
                const isActive = appState.currentPrayer === key;
                
                let icon = 'fa-clock';
                if(key === 'Fajr') icon = 'fa-cloud-sun';
                if(key === 'Sunrise') icon = 'fa-sun';
                if(key === 'Dhuhr') icon = 'fa-sun';
                if(key === 'Asr') icon = 'fa-cloud-sun';
                if(key === 'Maghrib') icon = 'fa-moon';
                if(key === 'Isha') icon = 'fa-star';

                const html = `
                    <div class="flex justify-between items-center p-4 transition-all duration-300 ${isActive ? 'prayer-active' : 'hover:bg-gray-50'}">
                        <div class="flex items-center gap-3">
                            <div class="w-8 text-center"><i class="fas ${icon} ${isActive ? 'text-white' : 'text-emerald-500'}"></i></div>
                            <span class="font-medium">${PRAYER_NAMES[key] || key}</span>
                        </div>
                        <span class="font-bold font-mono text-lg">${time}</span>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function renderMonthTable(data) {
            const tbody = document.getElementById('month-table-body');
            tbody.innerHTML = '';
            
            const now = new Date();
            const currentDay = now.getDate();
            const currentMonth = now.getMonth() + 1;
            const currentYear = now.getFullYear();

            // Datenmonat ermitteln für Highlighting
            const dataMonth = parseInt(data[0].date.gregorian.month.number);
            const dataYear = parseInt(data[0].date.gregorian.year);
            const isCurrentMonthView = (dataMonth === currentMonth && dataYear === currentYear);

            data.forEach(day => {
                const t = day.timings;
                const d = day.date.gregorian;
                const dayNum = parseInt(d.day);
                
                // Highlight nur wenn es wirklich heute ist (Tag + Monat + Jahr stimmen)
                const isToday = isCurrentMonthView && (dayNum === currentDay);

                // Responsive padding and hidden month name on mobile
                const row = `
                    <tr class="border-b ${isToday ? 'bg-emerald-100 font-semibold' : 'hover:bg-gray-50'}">
                        <td class="px-2 py-2 md:px-4 md:py-3 whitespace-nowrap">${d.day}. <span class="hidden sm:inline">${d.month.en.slice(0,3)}</span></td>
                        <td class="px-1 py-2 md:px-4 md:py-3 text-center">${parseTime(t.Fajr)}</td>
                        <td class="px-1 py-2 md:px-4 md:py-3 text-center">${parseTime(t.Dhuhr)}</td>
                        <td class="px-1 py-2 md:px-4 md:py-3 text-center">${parseTime(t.Asr)}</td>
                        <td class="px-1 py-2 md:px-4 md:py-3 text-center">${parseTime(t.Maghrib)}</td>
                        <td class="px-1 py-2 md:px-4 md:py-3 text-center">${parseTime(t.Isha)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
    </script>
</body>
</html>
